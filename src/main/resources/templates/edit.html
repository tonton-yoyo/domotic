<!DOCTYPE HTML>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit device</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script type="application/javascript" src="/js/iro.min.js"></script>
</head>
<body>
<div class="container-fluid">
    <p th:if="${error} != null" class="text-danger" th:text="${error}"></p>
    <form method="POST" th:action="${'/devices/' + id}">
        <div class="form-group">
            <label for="id">Id</label>
            <input id="id" name="id" type="text" class="form-control" th:value="${id}" required/>
        </div>
        <div class="form-group">
            <label for="name">Name</label>
            <input id="name" name="name" type="text" class="form-control" th:value="${name}" required/>
        </div>
        <div class="form-group">
            <label for="type">Type <span th:text="${type}"></span></label>
            <select id="type" name="type" class="form-control" onchange="onTypeChange(this)" required>
                <option value="SIMPLE_BULB" th:selected="${type == 'SIMPLE_BULB'}">SIMPLE_BULB</option>
                <option value="COLOR_BULB" th:selected="${type == 'COLOR_BULB'}">COLOR_BULB</option>
            </select>
        </div>
        <div class="form-group">
            <label for="duration">Duration</label>
            <input id="duration" name="duration" type="number" class="form-control" th:value="${duration}" required/>
        </div>
        <div id="brightnessPanel" class="form-group">
            <label for="brightness">Brightness</label>
            <input id="brightness" name="brightness" type="number" min="0" max="100" class="form-control" th:value="${brightness}" required/>
        </div>
        <div id="colorPanel" class="form-group" style="display: none">
            <label for="hue">Color</label>
            <div id="colorPicker"></div>
            <input id="hue" name="hue" type="text" th:value="${hue}" readonly/>
            <input id="saturation" name="saturation" type="text" th:value="${saturation}" readonly/>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-default" name="test">Test</button>
            <button type="submit" class="btn btn-primary pull-right">Update</button>
        </div>
    </form>
    <script type="application/javascript" th:inline="javascript">
        var colorPicker = new iro.ColorPicker("#colorPicker", {
            color: {
                h: [[${hue}]],
                s: [[${saturation}]],
                v: [[${brightness}]]
            }
        });
        colorPicker.on('color:change', function (color) {
            document.getElementById("brightness").value = color.value
            document.getElementById('hue').value = color.hue
            document.getElementById('saturation').value = color.saturation
        });

        function onTypeChange(elt) {
            var brightnessPanel = document.getElementById("brightnessPanel")
            var colorPanel = document.getElementById("colorPanel")
            if (elt.value === 'SIMPLE_BULB') {
                brightnessPanel.style.display = "block";
                colorPanel.style.display = "none";
            } else {
                colorPanel.style.display = "block";
                brightnessPanel.style.display = "none";
            }
        }
        onTypeChange(document.getElementById("type"))
    </script>
</div>
</body>
</html>